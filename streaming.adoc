= Streaming in riff

== Current request-reply model ==

.square possible invocations in sequence
[plantuml, format="png"]
----
box "Pod 1" #LightBlue
	participant invoker
	participant function
end box
participant cluster
participant client

== First request-reply ==
client -> cluster : `HTTP request [...] 'Host: square.default.example.com' [...] --data 8
cluster -> invoker : << activates pod >>
activate invoker
cluster -> invoker : << routes request >>
invoker -> function : << instanciates function once >>
activate function
invoker -> invoker : unmarshalls request payload
invoker -> function : invoke(fn,8)
function -> invoker : return 64
invoker -> invoker : marshalls response payload
invoker -> client : HTTP response with 64
== Second request-reply before scale-to-0 ==
client -> cluster : `HTTP request [...] 'Host: square.default.example.com' [...] --data 8
cluster -> invoker : << routes request >>
note right: the request could actually be routed to another pod instance instead
invoker -> invoker : unmarshalls payload
invoker -> function : invoke(fn,8)
function -> invoker : return 64
invoker -> invoker : marshalls response payload
invoker -> client : HTTP response with 64
...scale-to-zero timeout reached...
cluster -> invoker : <<scales pod down>>
invoker -> invoker : << shutdown >>
deactivate function
deactivate invoker
----

